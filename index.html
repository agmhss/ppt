<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini Slide Master v2</title>
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    { "imports": { "@google/genai": "https://esm.run/@google/genai" } }
    </script>
</head>
<body class="bg-sky-50 p-4 md:p-10 font-sans min-h-screen">
    <div class="max-w-4xl mx-auto bg-white shadow-2xl rounded-3xl overflow-hidden border-8 border-white">
        
        <header class="bg-gradient-to-r from-blue-500 to-indigo-600 p-8 text-white text-center">
            <h1 class="text-4xl font-black uppercase tracking-tighter">üöÄ Lesson AI Explorer</h1>
            <p class="text-blue-100 mt-2 font-medium">Turn textbooks into kid-friendly presentations!</p>
        </header>

        <section id="setup-view" class="p-8 space-y-8">
            <div class="bg-yellow-50 p-6 rounded-2xl border-2 border-yellow-200">
                <label class="block text-yellow-800 font-bold mb-2">üîë Step 1: Paste Gemini API Key</label>
                <input type="password" id="api-key-input" placeholder="AIzaSy..." class="w-full p-4 rounded-xl border-none ring-2 ring-yellow-200 focus:ring-yellow-400 shadow-inner">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="p-6 bg-blue-50 rounded-2xl border-2 border-blue-100">
                    <label class="block text-blue-800 font-bold mb-2">üìÑ Step 2: Textbook PDF</label>
                    <input type="file" id="pdf-file" accept="application/pdf" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:bg-blue-600 file:text-white hover:file:bg-blue-700 cursor-pointer">
                </div>
                <div class="p-6 bg-green-50 rounded-2xl border-2 border-green-100">
                    <label class="block text-green-800 font-bold mb-2">üìñ Step 3: Pages</label>
                    <div class="flex gap-4">
                        <input type="number" id="pg-start" value="1" class="w-1/2 p-2 rounded-lg border-green-200 focus:ring-2 focus:ring-green-400">
                        <input type="number" id="pg-end" value="5" class="w-1/2 p-2 rounded-lg border-green-200 focus:ring-2 focus:ring-green-400">
                    </div>
                </div>
            </div>

            <button id="main-action-btn" class="w-full py-5 bg-indigo-600 text-white rounded-2xl font-black text-2xl shadow-xl hover:bg-indigo-700 transition transform active:scale-95">
                ‚ú® CREATE MY LESSON!
            </button>
        </section>

        <section id="editor-view" class="hidden p-8 bg-gray-50 border-t-4 border-indigo-100">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-bold text-gray-800 italic">‚úèÔ∏è Your Slides</h2>
                <button id="download-btn" class="bg-green-500 hover:bg-green-600 text-white px-8 py-3 rounded-2xl font-black text-xl shadow-lg">
                    üì• DOWNLOAD PPTX
                </button>
            </div>
            <div id="slide-editor-container" class="space-y-6"></div>
        </section>
    </div>

    <script type="module">
        import { GoogleGenAI } from "@google/genai";

        let finalSlides = [];

        document.getElementById('main-action-btn').onclick = async () => {
            const key = document.getElementById('api-key-input').value.trim();
            const file = document.getElementById('pdf-file').files[0];
            const start = document.getElementById('pg-start').value;
            const end = document.getElementById('pg-end').value;

            if (!key) return alert("Please paste your API key!");
            if (!file) return alert("Please select a PDF file!");

            const btn = document.getElementById('main-action-btn');
            btn.disabled = true;
            btn.innerText = "‚è≥ Gemini is reading your book...";

            try {
                // INITIALIZE HERE TO CAPTURE THE KEY VALUE
                const genAI = new GoogleGenAI(key);
                const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash" });

                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = async () => {
                    const base64Data = reader.result.split(',')[1];
                    
                    const prompt = `Read pages ${start} to ${end} of this textbook. Generate 8-12 presentation slides for children. Return ONLY a JSON array of objects. Objects must have: title, bulletPoints (array of 3 strings), and youtubeSearch (string for video search).`;

                    const result = await model.generateContent([
                        { inlineData: { data: base64Data, mimeType: "application/pdf" } },
                        { text: prompt }
                    ]);

                    const responseText = result.response.text().replace(/```json|```/gi, "").trim();
                    finalSlides = JSON.parse(responseText);
                    
                    renderEditor();
                    document.getElementById('setup-view').classList.add('hidden');
                    document.getElementById('editor-view').classList.remove('hidden');
                };
            } catch (err) {
                alert("Error: " + err.message);
                btn.disabled = false;
                btn.innerText = "‚ú® CREATE MY LESSON!";
            }
        };

        function renderEditor() {
            const container = document.getElementById('slide-editor-container');
            container.innerHTML = finalSlides.map((s, i) => `
                <div class="bg-white p-6 rounded-3xl border-4 border-indigo-50 shadow-sm relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-2 bg-indigo-50 text-indigo-400 font-bold text-xs rounded-bl-xl">Slide ${i+1}</div>
                    <input class="w-full text-2xl font-black text-indigo-700 mb-4 focus:outline-none border-b-2 border-transparent focus:border-indigo-300" 
                           value="${s.title}" oninput="finalSlides[${i}].title = this.value">
                    <textarea class="w-full h-32 p-4 bg-gray-50 rounded-2xl text-gray-700 focus:ring-2 focus:ring-indigo-200 outline-none" 
                              oninput="finalSlides[${i}].bulletPoints = this.value.split('\\n')">${s.bulletPoints.join('\n')}</textarea>
                    <p class="mt-4 text-xs font-bold text-orange-500">üé¨ VIDEO SEARCH: ${s.youtubeSearch}</p>
                </div>
            `).join('');
        }

        document.getElementById('download-btn').onclick = () => {
            let pptx = new PptxGenJS();
            finalSlides.forEach(s => {
                let slide = pptx.addSlide();
                slide.background = { color: "F0F9FF" };
                slide.addText(s.title, { x: 0.5, y: 0.5, w: 9, h: 1, fontSize: 32, bold: true, color: "1E40AF", align: "center" });
                slide.addText(s.bulletPoints.join('\n'), { x: 1, y: 1.8, w: 8, h: 3, fontSize: 20, color: "334155", bullet: true });
                slide.addText("Watch: Search YouTube for " + s.youtubeSearch, { x: 0.5, y: 5.2, w: 9, h: 0.5, fontSize: 12, italic: true, color: "6366F1", align: "center" });
            });
            pptx.writeFile({ fileName: "My_AI_Lesson.pptx" });
        };
    </script>
</body>
</html>
